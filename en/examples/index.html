<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Examples - FCLib</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Examples";
    var mkdocs_page_input_path = "examples.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> FCLib</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">Overview</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Brief Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rules/">Some Rules</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Modules</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/camera/">Camera</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/geometry/">Geometry</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/odometry/">Odometry</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/lcdetection/">Loop Closure Detection</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/registration/">Point Cloud Registration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/optimization/">Optimization</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/integration/">Generate Model</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/visualization/">Visualization</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/algorithm/">Some Algorithms</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../modules/tool/">Other Useful Tools</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Examples</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#read-ply-files-and-visualize-the-point-cloud-or-mesh">Read PLY Files and Visualize the Point Cloud or Mesh</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#read-point-cloud-from-rgb-and-depth">Read Point Cloud from RGB and Depth</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sparsetracking-and-densetracking">SparseTracking and DenseTracking</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#generate-model-from-scannet-dataset">Generate Model from Scannet dataset</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mesh-simplification">Mesh Simplification</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bundle-adjustment">Bundle Adjustment</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#icp">ICP</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ransacregistration">RansacRegistration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#room-detection">Room Detection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#three-reconstruction-systems">Three Reconstruction Systems</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fbafusion">FBAFusion</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#bafusion">BAFusion</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#densefusion">DenseFusion</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Others</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../thanksto/">Acknowledgments</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About Author</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">FCLib</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Examples</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="examples">Examples</h2>
<p>Here are some examples of using FCLib. All the codes are in directory <code>examples</code>. After compilation, you can find the binary files in <code>build/example</code> and enter following commend to test.</p>
<h3 id="read-ply-files-and-visualize-the-point-cloud-or-mesh">Read PLY Files and Visualize the Point Cloud or Mesh</h3>
<pre><code>./ReadPLYPCD [filename.ply]
./ReadPLYMesh [filename.ply]
</code></pre>

<h3 id="read-point-cloud-from-rgb-and-depth">Read Point Cloud from RGB and Depth</h3>
<pre><code>./ReadRGBD [color] [depth]
</code></pre>

<h3 id="sparsetracking-and-densetracking">SparseTracking and DenseTracking</h3>
<pre><code>./SparseOdometry [source_rgb] [source_depth] [target_rgb] [targe_depth]
./SparseOdometryMild  [source_rgb] [source_depth] [target_rgb] [targe_depth]
./DenseOdometry  [source_rgb] [source_depth] [target_rgb] [targe_depth]
</code></pre>

<h3 id="generate-model-from-scannet-dataset">Generate Model from Scannet dataset</h3>
<p><code>example/GenerateModelFromScannet.cpp</code> can generate a model based on the given color, depth and camera pose. Note that there is an alignment between color and depth because of different camera intrinsics.</p>
<pre><code>./GenerateModelFromScannet [Path]
</code></pre>

<p><code>GetLabelUsingKDTree.cpp</code> can infer the semantic label of each point in generated model based on KDTree and the given labeled model.</p>
<pre><code>./GetLabelUsingKDTree [original model path] [reference model path]
</code></pre>

<h3 id="mesh-simplification">Mesh Simplification</h3>
<pre><code>./SimplifyMeshClustering [filename.ply] [grid_length]
./SimplifyMeshQuadric [filename.ply] [simplify_ratio]
</code></pre>

<p>Here are some resuls:</p>
<p><img alt="" src="../img/origin.bmp" />
<center><font color=gray>original model (hand.ply)</font></center></p>
<p><img alt="" src="../img/simplify_q.bmp" />
<center><font color=gray>using quadrics simplification(simplification rate = 90%)</font></center></p>
<p><img alt="" src="../img/simplify_c.bmp" />
<center><font color=gray>using voxel clustering (voxel_len = 0.1)</font></center></p>
<h3 id="bundle-adjustment">Bundle Adjustment</h3>
<p>Input a pair of RGBD frames,the camera poses will be adjusted according to the result of feature matching by Bundle Adjutment, and then the matching result will be visualized. You can also find several images in current directory which plot the reprojection results.</p>
<pre><code>./BATest [source_rgb] [source_depth] [target_rgb] [targe_depth]
</code></pre>

<p>The result will be like:</p>
<p><img alt="" src="../img/BATest.bmp" />
<center><font color=gray>alignment after BA</font></center></p>
<p><center>
<img src='../img/before_BA_target.png' width=45%/>
<img src='../img/after_BA_target.png' width=45%/>
</center>
<center><font color=gray>reprojection error comparison</font></center></p>
<p>The BA optimize the camera poses and coordinates of 3D points jointly. However, the alignment is just based on camera poses and camera intrinsics and don't utilize the coordinates parts. So generally the comparison of reprojection error should looks better than point cloud alignment.</p>
<h3 id="icp">ICP</h3>
<pre><code>ICPTest [source_pcd] [target_pcd]
</code></pre>

<p>ICPTest registers two point clouds. You can choose to use <code>PointToPlane</code> or <code>PointToPoint</code> by changing the code. From the experiment we can see <code>PointToPlane</code> have a much faster convergence rate.</p>
<p><img alt="" src="../img/point_point.bmp" />
<center><font color=gray>point_to_point</font></center></p>
<p><img alt="" src="../img/point_plane.bmp" />
<center><font color=gray>point_to_plane</font></center></p>
<h3 id="ransacregistration">RansacRegistration</h3>
<pre><code>RansacTest [source_pcd] [target_pcd]
</code></pre>

<p>RansacTest will register two point cloud. At the beginning, the source point cloud will be rotated randomly and translated, so we can see clearly what GlobalRegistration can do.</p>
<p>The following images show the results. You can choose to visualize the alignments or correspondences as you want by changing the example code.</p>
<p><img alt="" src="../img/ransac.bmp" />
<center><font color=gray>ransac registration</font></center></p>
<p><img alt="" src="../img/ransac_corr.bmp" />
<center><font color=gray>fpfh correspondence</font></center></p>
<h3 id="room-detection">Room Detection</h3>
<p>You can do some interesting things by uisng module <code>algorithm</code>. In <code>example/RoomDetection.cpp</code>, we can get the 2d map of the room from the room model with semantic labels. We use LineDetection, PlaneDetection( acturally we just need to detect the lines or planes), DCEL, KMedoidsClusteringDynamic.</p>
<pre><code>./RoomDetection ../../TestData/room_with_labels.ply
</code></pre>

<p>Input model:</p>
<p><img alt="" src="../img/room_with_label.bmp" /></p>
<p>Results:</p>
<p><center>
<img src =../img/lines_.bmp width=49%><img src =../img/planes_.bmp width=49%>
</center>
<center><font color=gray>detected lines/planes</font></center></p>
<p><center>
<img src =../img/cells_.bmp width=49%><img src =../img/room_map_.bmp width=49%></center>
<center><font color=gray>generated Line Arrangements/2d map</font></center></p>
<p>For details, refer to <a href="https://www.sciencedirect.com/science/article/pii/S0097849314000661">Automatic room detection and reconstruction in cluttered indoor environments with complex room layouts</a>.</p>
<h3 id="three-reconstruction-systems">Three Reconstruction Systems</h3>
<p>A slam system wihout an backend is incomplete. If you just track frames and don't optimize the poses, the results will have ghosting, just like this:
<img alt="" src="../img/without_loop.bmp" /></p>
<p>FCLib implements three complete SLAM systems, which are different in backend or tracking method.</p>
<h4 id="fbafusion">FBAFusion</h4>
<p>FBAFusion using SparseTracking, Mild loop closure detector,Fast BundleAdjustment for optimization. </p>
<pre><code>./FBAFusion ../../TestData/rgbd/607 0.01
</code></pre>

<p>You should see:</p>
<p><img alt="" src="../img/index.gif" /></p>
<p>FBAFusion is the fastest of the three, the generated model looks like:</p>
<p><img alt="" src="../img/FBAFusion.bmp" /></p>
<h4 id="bafusion">BAFusion</h4>
<p>BAFusion uses SparseTracking, Mild closed-loop detection, plus BundleAdjustment back-end optimization. As mentioned before, BA will have a larger matrix dimension in later stage. Even in BAFusion, each keyframe has only 30 feature points for coordinate optimization, and it still takes about a minute or more to optimize them. And BA will optimize the spatial points (optimize the projection noise and parameters), but this part of the optimization is not considered when the final model is generated, only the optimized pose is used, so the reconstruction model does not look as good as FBAFusion. However, you can still see the optimization effects (no ghosting). If all aspects are taken into consideration, the effects of BA should be the best.</p>
<pre><code>./BAFusion ../../TestData/rgbd/607 0.01
</code></pre>

<p>Generated model:
<img alt="" src="../img/BAFusion.bmp" /></p>
<h4 id="densefusion">DenseFusion</h4>
<p>DenseFusion using DenseTracking, without a 2D loop closure detetion. It takes every <span class="arithmatex">\(N\)</span> of the read frame as a submap. When a new submap is detected, BAFusion perform GlobalRegistration for the current submap and the previous submaps, and then sets a threshold to detect whether there is a correct loop closure. Of course, DenseTracking and GlobalRegistration are much slower than SparseTracking and MILD loop closure detection. Therefore, DenseFusion is also slower that FBAFusion and is an offline reconstruction system. As for backend optimization, DenseFusion uses Fast BundleAdjustment.</p>
<pre><code>./DenseFusion ../../TestData/rgbd/607 0.01
</code></pre>

<p>Generated model:
<img alt="" src="../img/DenseFusion.bmp" /></p>
<p><em>Note: The color looks strange because of the default BGR format of OpenCV.</em></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../thanksto/" class="btn btn-neutral float-right" title="Acknowledgments">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../modules/tool/" class="btn btn-neutral" title="Other Useful Tools"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/MyEvolution/FCLib" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../modules/tool/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../thanksto/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../javascripts/config.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
